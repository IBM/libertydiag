<?xml version="1.0" encoding="UTF-8"?>
<server>
  <featureManager>
    <feature>jakartaee-9.1</feature>
    <feature>microProfile-5.0</feature>
  </featureManager>

  <!--
    These will be overridden by an overrides XML file generated by the Maven
    build (see pom.xml or override with `mvn -Dliberty.var.${NAME}`) although 
    we specify default values in case this server.xml is copied and used
    elsewhere. When changing a default here, it's usually good to change it in
    pom.xml also.
  -->
  <variable name="APP_NAME" defaultValue="libertydiag.war" />
  <variable name="HTTP_PORT" defaultValue="9080" />
  <variable name="HTTPS_PORT" defaultValue="9443" />
  <variable name="TRACE_SPECIFICATION" defaultValue="*=info" />
  <variable name="MAX_TRACE_SIZE_MB" defaultValue="100" />
  <variable name="MAX_TRACE_SIZE_COUNT" defaultValue="2" />
  <variable name="MAX_REQUEST_SECONDS" defaultValue="5" />
  <variable name="HUNG_REQUEST_SECONDS" defaultValue="300" />
  <variable name="REQUEST_TIMING_SAMPLE_RATE" defaultValue="1" />

  <!--
    In a container environment, X_LOG_DIR points to /logs/, but it doesn't 
    exist in a non-Docker environment, so we point the default to the normal 
    usr/servers/${SERVER}/logs/ directory.
  -->
  <variable name="X_LOG_DIR" defaultValue="${server.output.dir}/logs" />

  <basicRegistry id="basic" realm="BasicRealm">
    <user name="admin" password="password" />
    <group name="Administrators">
      <member name="admin" />
    </group>
  </basicRegistry>
  
  <administrator-role>
    <group>Administrators</group>
  </administrator-role>

  <!--
    Decide whether administrator authentication (administrator-role) is required
    for /metrics. HTTPS may still be used without authentication.
  -->
  <mpMetrics authentication="false" />

  <!--
    By default, mpMetrics enables all monitor-1.0 metrics. A space for a filter
    disables these metrics and just leaves base and app metrics which has less
    performance overhead. If needed, enable additional metrics by replacing the
    space with a command-delimited list from:
    JVM,ThreadPool,WebContainer,Session,ConnectionPool,REST
  -->
  <monitor filter=" " />

  <!-- host="*" allows access from a remote client -->
  <httpEndpoint
    id="defaultHttpEndpoint"
    host="*"
    httpPort="${HTTP_PORT}"
    httpsPort="${HTTPS_PORT}"
  >
    <accessLogging
      filepath="${X_LOG_DIR}/http_access.log"
      maxFileSize="${MAX_TRACE_SIZE_MB}"
      maxFiles="${MAX_TRACE_SIZE_COUNT}"
      logFormat="%h %u %t &quot;%r&quot; %s %b %D %{R}W %p %{remote}p"
    />
  </httpEndpoint>

  <!-- Automatically expand WAR files and EAR files -->
  <applicationManager autoExpand="true" />

  <!-- Configures the application on a specified context root -->
  <webApplication contextRoot="/" location="${APP_NAME}" />

  <!--
    Default SSL configuration enables trust for default certificates from the
    Java runtime.
  -->
  <ssl id="defaultSSLConfig" trustDefaultCerts="true" />
</server>
